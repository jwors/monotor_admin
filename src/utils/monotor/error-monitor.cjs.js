"use strict";class e{constructor(e){this.options=e,this.initErrorTracking()}initErrorTracking(){window.addEventListener("error",this.handleWindowError.bind(this),!0),window.addEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this),!0),this.options.consoleError&&this.overrideConsoleError()}handleWindowError(e){const n={type:"window_error",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?.stack,timestamp:(new Date).toISOString()};this.options.onError(n)}handleUnhandledRejection(e){const n={type:"unhandled_rejection",reason:e.reason?.message||String(e.reason),stack:e.reason?.stack,timestamp:(new Date).toISOString()};this.options.onError(n)}overrideConsoleError(){const e=console.error;console.error=(...n)=>{e.apply(console,n);const o={type:"console_error",messages:n,timestamp:(new Date).toISOString()};this.options.onError(o)}}}class n{constructor(e){this.options={url:"",maxRetry:3,timeOut:3e3,...e},this.queue=[],this.isSending=!1}send(e){this.queue.push(e),this.isSending||this.processQueue()}async processQueue(){if(0===this.queue.length)return void(this.isSending=!1);this.isSending=!0;const e=this.queue.shift();try{await this.sendRequest(e),this.processQueue()}catch(n){if(console.error("Report Error",n),e.retryCount<this.options.maxRetry){e.retryCount=(e.retryCount||0)+1,this.queue.unshift(e);let n=setTimeout(()=>{clearTimeout(n),this.processQueue()},1e3)}else this.processQueue()}}sendRequest(e){return new Promise((n,o)=>{const i=new AbortController,t=setTimeout(()=>i.abort(),this.options.timeout);fetch(this.options.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:i.signal}).then(e=>{if(clearTimeout(t),!e.ok)throw new Error("Network response was not ok");n()}).catch(e=>{clearTimeout(t),o(e)})})}}function o(){const e=navigator.userAgent,n=window.screen,o=/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),i=/iPad|Android|Tablet/i.test(e)&&!o;let t="Unknown";e.includes("Firefox")?t="Firefox":e.includes("SamsungBrowser")?t="Samsung Browser":e.includes("Opera")||e.includes("OPR/")?t="Opera":e.includes("Trident/")?t="IE":e.includes("Edge")?t="Edge":e.includes("Chrome")?t="Chrome":e.includes("Safari")&&(t="Safari");let r="Unknown";e.includes("Android")?r="Android":e.includes("iPhone")||e.includes("iPad")||e.includes("iPod")?r="iOS":e.includes("Windows")?r="Windows":e.includes("Mac OS X")?r="Mac OS":e.includes("Linux")&&(r="Linux");const s=n.orientation?n.orientation.type:n.height>n.width?"portrait":"landscape";return{deviceType:o?"Mobile":i?"Tablet":"Desktop",browser:t,browserVersion:e.match(/(Firefox|Chrome|Safari|Opera|Edge|IE|Version)[\/\s](\d+)/i)?.[2]||"Unknown",os:r,osVersion:e.match(/(Windows NT|Android|iPhone OS|Mac OS X|Linux)[\s\/](\d+[._]\d+)/i)?.[2]||"Unknown",screenWidth:n.width,screenHeight:n.height,colorDepth:n.colorDepth,pixelRatio:window.devicePixelRatio||1,orientation:s,language:navigator.language||navigator.userLanguage||"Unknown",online:navigator.onLine,userAgent:e,cpuCores:navigator.hardwareConcurrency||"Unknown",deviceMemory:navigator.deviceMemory||"Unknown",touchSupport:"ontouchstart"in window||navigator.maxTouchPoints>0}}module.exports=class{constructor(e={}){this.options={dsn:"",appId:"",enablePerformance:!0,enableXHRMonitoring:!0,...e},this.reporter=new n({url:this.options.dsn}),this.init()}init(){new e({onError:this.handleError.bind(this)}),this.options.enablePerformance&&this.initPerformance(),this.options.enableXHRMonitoring&&this.initXHRMonitoring()}handleError(e){const n={...e,appId:this.options.appId,deviceInfo:o(),location:window.location.href,userAgent:navigator.userAgent};this.reporter.send(n)}initPerformance(){}initXHRMonitoring(){}};
